!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@xlayers/svg-codegen"),require("@xlayers/css-codegen"),require("@xlayers/sketch-lib")):"function"==typeof define&&define.amd?define("@xlayers/xaml-codegen",["exports","@angular/core","@xlayers/svg-codegen","@xlayers/css-codegen","@xlayers/sketch-lib"],e):e(((t=t||self).xlayers=t.xlayers||{},t.xlayers["xaml-codegen"]={}),t.ng.core,t.svgCodegen,t.cssCodegen,t.sketchLib)}(this,(function(t,e,o,r,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function s(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var a=function(){return(a=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function u(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],r=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var c=function(){function t(){}return t.prototype.generateTemplate=function(t){var e=[];return this.visit(t,e,2),e.join("\n")},t.prototype.visit=function(t,e,o){var r=this;if(void 0===e&&(e=[]),void 0===o&&(o=0),!t.layers||!Array.isArray(t.layers))return"text"===t._class?this.visitText(t):"bitmap"===t._class?this.visitBitmap(t):t.shape?this.visitShape(t):this.visitOther(t);t.layers.forEach((function(t){return r.visitLayer(t,e,o)}))},t.prototype.visitLayer=function(t,e,o){var r=this.visit(t,e,o+1);r&&e.push(r)},t.prototype.visitShape=function(t){return t.shape},t.prototype.colorRatioToHex=function(t){return"#"+Math.round(255*t.red).toString(16).padStart(2,"0")+Math.round(255*t.green).toString(16).padStart(2,"0")+Math.round(255*t.blue).toString(16).padStart(2,"0")},t.prototype.checkLayersForBorder=function(t){var e,o,r=!1;try{for(var n=u(t.layers),i=n.next();!i.done;i=n.next()){var s=i.value;if(!1!==(r=this.checkForBorder(t,s)))return r}}catch(t){e={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}return r},t.prototype.checkForBorder=function(t,e){return!(0!==e.frame.x||0!==e.frame.y||t.frame.width!==e.frame.width||t.frame.height!==e.frame.height||!e.style.borders)&&(e.shapeVisited=!0,this.colorRatioToHex(e.style.borders[0].color))},t.prototype.checkLayersForBackground=function(t){var e,o,r=!1;try{for(var n=u(t.layers),i=n.next();!i.done;i=n.next()){var s=i.value;if(!1!==(r=this.checkForBackground(t,s)))return r}}catch(t){e={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}return r},t.prototype.checkForBackground=function(t,e){return!(0!==e.frame.x||0!==e.frame.y||t.frame.width!==e.frame.width||t.frame.height!==e.frame.height||!e.style.fills||0===e.style.fills[0].color.alpha)&&(e.shapeVisited=!0,this.colorRatioToHex(e.style.fills[0].color))},t}();var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.indentationSymbol="  ",e}return s(e,t),e.prototype.openTag=function(t,e,o){return void 0===e&&(e=[]),void 0===o&&(o=!1),"<"+t+(0!==e.length?" "+e.join(" "):"")+(o?" /":"")+">"},e.prototype.closeTag=function(t){return"</"+t+">"},e.prototype.indent=function(t,e){var o=t?this.indentationSymbol.repeat(t):"";return o+e.split("\n").join("\n"+o)},e}(c);var h=function(){function t(t,e){if(void 0===e){var o=this.stringToCoords(t);o&&(this.x=this.decRound(o.x),this.y=this.decRound(o.y))}else this.x=this.decRound(t),this.y=this.decRound(e)}return t.prototype.decRound=function(t){return Math.round(100*t+.001)/100},t.prototype.distanceRounded=function(t){return this.decRound(this.distance(t))},t.prototype.distance=function(t){return Math.sqrt(this.distanceSquared(t))},t.prototype.distanceSquaredRounded=function(t){return this.decRound(this.distanceSquared(t))},t.prototype.distanceSquared=function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},t.prototype.stringToCoords=function(t){var e=t.match(/{(?<x>\-?\d(?:\.\d+)?(?:e\-?\d+)?),\s?(?<y>\-?\d(?:\.\d+)?(?:e\-?\d+)?)}/);return!!e&&e.groups},t}();var d=function(){function t(t){this.points=[],void 0!==t&&this.addPoint(t)}return t.prototype.updateBarycenter=function(){var t=0,e=0;this.points.forEach((function(o){t+=o.x,e+=o.y})),t/=this.points.length,e/=this.points.length,this.barycenter=new h(t,e)},t.prototype.addPoint=function(t){this.points.push(t),this.updateBarycenter()},t}();var p=function(){function t(t){var e=this;this.points=[],t.forEach((function(t){e.points.push(new h(t.point)),!0===t.hasCurveFrom&&e.points.push(new h(t.curveFrom)),!0===t.hasCurveTo&&e.points.push(new h(t.curveTo))}))}return t.isOrthogonal=function(e,o,r){return Math.abs(e.distanceSquared(o)+o.distanceSquared(r)-e.distanceSquared(r))<t.shapeRecognitionPrecision},t.prototype.clusterPoints4=function(){var t=0,e=0;this.points.forEach((function(o){t+=o.x,e+=o.y}));var o=new h(t/this.points.length,e/this.points.length),r={};return r.topLeft=new d,r.topRight=new d,r.bottomLeft=new d,r.bottomRight=new d,this.points.forEach((function(t){t.y<o.y?t.x<o.x?r.topLeft.addPoint(t):r.topRight.addPoint(t):t.x<o.x?r.bottomLeft.addPoint(t):r.bottomRight.addPoint(t)})),r},t.prototype.isRectangle=function(){if(this.points.length<4)return!1;var e=this.clusterPoints4();for(var o in e)if(0===e[o].points.length)return!1;var r=e.topLeft.barycenter.distance(e.topRight.barycenter),n=e.bottomLeft.barycenter.distance(e.bottomRight.barycenter),i=e.topLeft.barycenter.distance(e.bottomLeft.barycenter),s=e.topRight.barycenter.distance(e.bottomRight.barycenter);return Math.abs(r-n)<t.shapeRecognitionPrecision&&Math.abs(i-s)<t.shapeRecognitionPrecision&&t.isOrthogonal(e.bottomLeft.barycenter,e.topLeft.barycenter,e.topRight.barycenter)},t.prototype.isLine=function(){return 2===this.points.length&&Math.abs(this.points[0].y-this.points[1].y)<t.shapeRecognitionPrecision},t.prototype.isRound=function(){if(this.isRectangle()||this.isLine())return!1;var e=new d;this.points.forEach((function(t){e.addPoint(t)}));var o=new h(.5,.5),r=e.points[0].distanceSquaredRounded(e.barycenter),n=e.points[0].distanceSquaredRounded(o),i=!0,s=!0;return e.points.some((function(o){if(Math.abs(o.distanceSquaredRounded(e.barycenter)-r)>2*t.shapeRecognitionPrecision)return i=!1,!0})),e.points.some((function(e){if(Math.abs(e.distanceSquaredRounded(o)-n)>2*t.shapeRecognitionPrecision)return s=!1,!0})),i||s},t.shapeRecognitionPrecision=.05,t}();var f=function(t){function r(e){var o=t.call(this)||this;return o.svgCodeGen=e,o.fileList=[],o}return s(r,t),r.prototype.visitLayer=function(t,e,o){var r;void 0===e&&(e=[]),void 0===o&&(o=0),"group"===t._class?(e.push(this.indent(o,this.openGroup(t))),r=this.visit(t,e,o+1),e.push(this.indent(o+1,this.closeTag("AbsoluteLayout"))),e.push(this.indent(o,this.closeTag("Frame")))):r=this.visit(t,e,o+1),r&&e.push(this.indent(o+1,r))},r.prototype.visitBitmap=function(t){return'<Image Source="'+t.image._ref+'">'},r.prototype.visitText=function(t){var e={},o=t.attributedString,r=o.attributes[0].attributes.MSAttributedStringFontAttribute.attributes,n=o.attributes[0].attributes.MSAttributedStringColorAttribute;return e.Text=o.string,e.FontSize=r.size,e.FontFamily=r.name,e.TextColor=this.colorRatioToHex(n),e.Opacity=n.alpha,e["AbsoluteLayout.LayoutBounds"]=Math.round(t.frame.x)+", "+Math.round(t.frame.y)+", "+Math.round(t.frame.width)+", "+Math.round(t.frame.height),"<Label "+Object.keys(e).map((function(t){return t+'="'+e[t]+'"'})).join("\n"+" ".repeat(7))+"/>"},r.prototype.visitShape=function(t){if(!0===t.shapeVisited)return null;var e=new p(t.points);return e.isRound()?this.visitRound(t):e.isRectangle()?this.visitRectangle(t):e.isLine()?this.visitLine(t):this.visitSvg(t)},r.prototype.visitOther=function(t){return!0===t.shapeVisited?null:"oval"===t._class||"rectangle"===t._class&&(t.style.fills||t.style.borders)?"<Frame "+this.generateAbsoluteLayout(t)+' CornerRadius="'+("oval"===t._class?t.frame.width/2:"0")+'"'+(t.style.fills?' BackgroundColor="'+this.colorRatioToHex(t.style.fills[0].color)+'" Opacity="'+t.style.fills[0].color.alpha+'"':' BackgroundColor="Transparent"')+(t.style.borders?' BorderColor="'+this.colorRatioToHex(t.style.borders[0].color)+'"':"")+' HasShadow="false" />':void 0},r.prototype.visitRound=function(t){return"<Frame "+this.generateAbsoluteLayout(t)+' CornerRadius="'+t.frame.width/2+'"'+(t.style.fills?' BackgroundColor="'+this.colorRatioToHex(t.style.fills[0].color)+'" Opacity="'+t.style.fills[0].color.alpha+'"':' BackgroundColor="Transparent"')+(t.style.borders?' BorderColor="'+this.colorRatioToHex(t.style.borders[0].color)+'"':"")+' HasShadow="false" />'},r.prototype.visitRectangle=function(t){return t.style.borders?"<Frame "+this.generateAbsoluteLayout(t)+' CornerRadius="0" BorderColor="'+this.colorRatioToHex(t.style.borders[0].color)+'"'+(t.style.fills?' BackgroundColor="'+this.colorRatioToHex(t.style.fills[0].color)+'" Opacity="'+t.style.fills[0].color.alpha+'"':' BackgroundColor="Transparent"')+' HasShadow="false" />':t.style.fills?"<BoxView "+this.generateAbsoluteLayout(t)+' Color="'+this.colorRatioToHex(t.style.fills[0].color)+'" Opacity="'+t.style.fills[0].color.alpha+'" />':""},r.prototype.visitLine=function(t){return'<BoxView AbsoluteLayout.LayoutBounds="'+Math.round(t.frame.x)+", "+Math.round(t.frame.y)+", "+Math.round(t.frame.width)+', 1"'+(t.style.fills?' Color="'+this.colorRatioToHex(t.style.fills[0].color)+'" Opacity="'+t.style.fills[0].color.alpha+'" />':' Color="'+this.colorRatioToHex(t.style.borders[0].color)+'" Opacity="'+t.style.borders[0].color.alpha+'" />')},r.prototype.visitSvg=function(t){var e=this.sanitizeSvgFileName(t.do_objectID);return this.fileList.push(a({},this.svgCodeGen.aggregate(t)[0],{uri:e,kind:"xamarinForms"})),'<ffSvg:SvgCachedImage Source="resource://xLayers.path.to.'+e+'"\n'+" ".repeat(22)+this.generateAbsoluteLayout(t)+"/>"},r.prototype.openGroup=function(t){var e=this.checkLayersForBorder(t),o=this.checkLayersForBackground(t);return"<Frame "+this.generateAbsoluteLayout(t)+' CornerRadius="0" Padding="0"'+(!1!==e?' BorderColor="'+e+'"':"")+' BackgroundColor="'+(!1!==o?o:"Transparent")+'" HasShadow="false">\n  <AbsoluteLayout>'},r.prototype.sanitizeSvgFileName=function(t){return"_"+t.toLowerCase().replace(/[^a-z0-9\_]/g,"_")+".svg"},r.prototype.generateAbsoluteLayout=function(t){return'AbsoluteLayout.LayoutBounds="'+Math.round(t.frame.x)+", "+Math.round(t.frame.y)+", "+Math.round(t.frame.width)+", "+Math.round(t.frame.height)+'"'},r.prototype.consumeFileList=function(){var t=this.fileList;return this.fileList=[],t},r.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],r.ctorParameters=function(){return[{type:o.SvgCodeGenService}]},r.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new r(e.ɵɵinject(o.SvgCodeGenService))},token:r,providedIn:"root"}),r}(l);var y=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[r.CssCodeGenModule,o.SvgCodeGenModule,n.SketchLibModule]}]}],t}();t.XamarinFormsCodeGenVisitor=f,t.XamlCodeGenModule=y,t.ɵa=l,t.ɵb=c,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=xlayers-xaml-codegen.umd.min.js.map